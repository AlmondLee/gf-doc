# 数据库配置
数据库配置可以在全局配置文件config.json中进行配置，如下：
```go
{
    "database"   : {
        "default" : [
            {
                "host"     : "127.0.0.1",
                "port"     : "3306",
                "user"     : "root",
                "pass"     : "123456",
                "name"     : "test",
                "type"     : "mysql",
                "role"     : "master",
                "charset"  : "utf8",
                "priority" : "1"
            },
            {
                "host"     : "127.0.0.1",
                "port"     : "3306",
                "user"     : "root",
                "pass"     : "123456",
                "name"     : "test",
                "type"     : "mysql",
                "role"     : "master",
                "charset"  : "utf8",
                "priority" : "1"
            }
        ]
    }
}
```
也可以通过gdb包配置管理方法进行全局配置，如下：
```go
gdb.SetConfig(gdb.Config {
    "default" : gdb.ConfigGroup {
        gdb.ConfigNode {
            Host     : "127.0.0.1",
            Port     : "3306",
            User     : "root",
            Pass     : "123456",
            Name     : "test",
            Type     : "mysql",
            Role     : "master",
            Priority : 100,
        },
        gdb.ConfigNode {
            Host     : "127.0.0.2",
            Port     : "3306",
            User     : "root",
            Pass     : "123456",
            Name     : "test",
            Type     : "mysql",
            Role     : "master",
            Priority : 100,
        },
        gdb.ConfigNode {
            Host     : "127.0.0.3",
            Port     : "3306",
            User     : "root",
            Pass     : "123456",
            Name     : "test",
            Type     : "mysql",
            Role     : "master",
            Priority : 100,
        },
        gdb.ConfigNode {
            Host     : "127.0.0.4",
            Port     : "3306",
            User     : "root",
            Pass     : "123456",
            Name     : "test",
            Type     : "mysql",
            Role     : "master",
            Priority : 100,
        },
    },
})
```
gdb的数据库配置管理功能非常强大，支持分组配置、集群管理、Master-Slave模式、内置负载均衡管理等特点。
1. gdb配置管理支持对数据库配置进行分组管理，获取数据库操作对象时可以按照分组名称进行获取；
2. gdb配置管理支持多关系型数据库管理，通过Type属性进行配置；
3. gdb配置管理支持Master-Slave模式，通过Role属性进行配置；
4. gdb配置管理支持负载均衡管理，通过Priority属性进行配置，值越大，优先级越高；

数据库相关数据结构如下：
```go
type List        []Map
type Map         map[string]interface{}

type Config      map[string]ConfigGroup
type ConfigGroup []ConfigNode
type ConfigNode  struct {
    Host     string // 地址
    Port     string // 端口
    User     string // 账号
    Pass     string // 密码
    Name     string // 数据库名称
    Type     string // 数据库类型：mysql, sqlite, mssql, pgsql, oracle(目前仅支持mysql)
    Role     string // (可选，默认为master)数据库的角色，用于主从操作分离，至少需要有一个master，参数值：master, slave
    Charset  string // (可选，默认为 utf-8)编码，默认为 utf-8
    Priority int    // (可选)用于负载均衡的权重计算，当集群中只有一个节点时，权重没有任何意义
    Linkinfo string // (可选)自定义链接信息，当该字段被设置值时，以上链接字段(Host,Port,User,Pass,Name)将失效(该字段是一个扩展功能)
}
```
数据库配置管理方法列表：
```go
func AddConfigGroup(group string, nodes ConfigGroup)
func AddConfigNode(group string, node ConfigNode)
func AddDefaultConfigGroup(nodes ConfigGroup)
func AddDefaultConfigNode(node ConfigNode)
func SetConfig(c Config)
func SetDefaultGroup(groupName string)
```


# 数据库操作

数据库操作接口：
```go
type Link interface {
    Open(c *ConfigNode) (*sql.DB, error)
    Close() error
    Query(q string, args ...interface{}) (*sql.Rows, error)
    Exec(q string, args ...interface{}) (sql.Result, error)
    Prepare(q string) (*sql.Stmt, error)

    GetAll(q string, args ...interface{}) (List, error)
    GetOne(q string, args ...interface{}) (Map, error)
    GetValue(q string, args ...interface{}) (interface{}, error)

    PingMaster() error
    PingSlave() error

    SetMaxIdleConns(n int)
    SetMaxOpenConns(n int)

    Begin() (*sql.Tx, error)
    Commit() error
    Rollback() error

    Insert(table string, data Map) (sql.Result, error)
    Replace(table string, data Map) (sql.Result, error)
    Save(table string, data Map) (sql.Result, error)

    BatchInsert(table string, list List, batch int) error
    BatchReplace(table string, list List, batch int) error
    BatchSave(table string, list List, batch int) error

    Update(table string, data interface{}, condition interface{}, args ...interface{}) (sql.Result, error)
    Delete(table string, condition interface{}, args ...interface{}) (sql.Result, error)

    Table(tables string) *gLinkOp
}
```

# 数据库示例

1. 获取数据库操作对象
```go
// 获取默认配置的数据库对象(配置名称为"default")
db := gins.Database()
// 获取配置分组名称为"user-center"的数据库对象
db := gins.Database("user-center")
```
2. 数据写入
```go
r, err := db.Insert("user", gdb.Map {
    "name": "john",
})
```
3. 数据查询(列表)
```go
list, err := db.GetAll("select * from user limit 2")
```

4. 数据查询(单条)
```go
list, err := db.GetOne("select * from user limit 2")
```

5. 数据保存
```go
r, err := db.Save("user", gdb.Map {
        "uid"  :  1,
        "name" : "john",
    })
```

6. 批量操作
```go
// BatchInsert/BatchReplace/BatchSave
err := db.BatchInsert("user", gdb.List {
    {"name": "john_" + strconv.FormatInt(time.Now().UnixNano(), 10)},
    {"name": "john_" + strconv.FormatInt(time.Now().UnixNano(), 10)},
    {"name": "john_" + strconv.FormatInt(time.Now().UnixNano(), 10)},
    {"name": "john_" + strconv.FormatInt(time.Now().UnixNano(), 10)},
}, 10)
```

7. 数据更新/删除
```go
// db.Update/db.Delete
r, err := db.Update("user", gdb.Map {"name": "john1"}, "uid=?", 1)
r, err := db.Update("user", "name='john2'", "uid=1")
r, err := db.Update("user", "name=?", "uid=?", "john2", 1)
```




