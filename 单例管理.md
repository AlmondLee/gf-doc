
单例管理器由```gins包```进行封装，提供了对进程中单例对象的注册以及获取，并对框架中的核心组件进行了封装。该模块的耦合度比较高，主要是为简化常用对象的调用，以及为自定义单例对象控制提供了支持。

封装的核心组件：```模板引擎```、```配置管理```、```数据库ORM```、```Redis对象```，并提供了特定的```Set*```方法进行自定义替换。

单例管理器的一个优点是提供了K-V形式的对象管理机制(```Set/Get```)，随时可以对已存在对象进行注册/替换。

>[danger] # 方法列表

```go
func Set(k string, v interface{})
func Get(k string) interface{}

func SetConfig(v *gcfg.Config)
func SetDatabase(v *gdb.Db, name ...string)
func SetRedis(v *gredis.Redis, name...string)
func SetView(v *gview.View)

func Config() *gcfg.Config
func Database(name ...string) *gdb.Db
func Redis(name ...string) *gredis.Redis
func View() *gview.View
```

>[danger] # 自动检测更新

与配置管理器一样，单例管理器对于单例对象配置的变更拥有自动检测更新机制。当配置文件发生变更时，单例管理器中的单例对象将会被刷新，下一次再使用时将会读取最新的配置重新生成单例对象。我们拿redis客户端单例对象来做一个示例。

1. 首先，redis在配置文件中的配置如下：
    ```yml
    redis:
        disk:  127.0.0.1:6379,0
        cache: 127.0.0.1:6379,1
    ```
1. 其次，我们通过```redis-cli```向redis server中的```db 1```和```db 2```分别存放两条KV数据，分别是：```k:v1```和```k:v2```。
    ```shell
    127.0.0.1:6379[1]> set k v1
    OK
    127.0.0.1:6379[1]> get k
    "v1"
    127.0.0.1:6379[1]> select 2
    OK
    127.0.0.1:6379[2]> set k v2
    OK
    127.0.0.1:6379[2]> get k
    "v2"
    ```
1. 最后，我们的示例程序如下：
    ```go
    package main

    import (
        "time"
        "gitee.com/johng/gf/g/os/gtime"
        "gitee.com/johng/gf/g/frame/gins"
    )

    func main() {
        gins.Config().SetPath("/home/john/Workspace/Go/gitee.com/johng/gf/geg/frame")
        gtime.SetInterval(2*time.Second, func() bool {
            redis := gins.Redis("cache")
            redis.Do("GET", "k")
            return true
        })
        select{}
    }
    ```
    在该示例中，我们每隔2秒获取```cache```分组配置的redis客户端单例对象，获取并打印出redis-server中键名为```k```的键值。由于```config.yml```中redis的cache分组配置的db为1（```127.0.0.1:6379,1```），那么打印出的内容将是```k1```。
    
    这个时候我们手动修改```config.yml```，将redis的cache分组配置改为```127.0.0.1:6379,2```，保存文件后，可以看到，终端输出的键值立即变成了```v2```。表明单例管理器已经检测到了外部配置文件的变更，即时地更新了内存中的redis客户端单例对象。
