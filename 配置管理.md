[TOC]


gf的配置管理由gcfg包提供支持，gcfg包是读取安全的，仅提供配置文件读取功能，不提供数据写入/修改功能，**支持的数据文件格式包括： JSON、XML、YAML/YML、TOML**。如果想要支持对数据文件的读取和修改，并且可以进行数据格式转换，请参看gparser包。

>[danger] # 方法列表

配置管理相关方法列表：

```go
type Config
    func New(path string) *Config
    func (c *Config) Get(pattern string, files ...string) interface{}
    func (c *Config) GetArray(pattern string, files ...string) []interface{}
    func (c *Config) GetBool(pattern string, files ...string) bool
    func (c *Config) GetFloat32(pattern string, files ...string) float32
    func (c *Config) GetFloat64(pattern string, files ...string) float64
    func (c *Config) GetInt(pattern string, files ...string) int
    func (c *Config) GetMap(pattern string, files ...string) map[string]interface{}
    func (c *Config) GetString(pattern string, files ...string) string
    func (c *Config) GetUint(pattern string, files ...string) uint
    func (c *Config) SetPath(path string)
```

gcfg包最大的特点是支持按层级获取配置数据，层级访问通过英文"."号指定，其中pattern参数和[gjson包](JSON模块.md)的pattern参数一致。参数files指定需要读取的配置文件目录下的文件名称，是一个可选参数，默认为config.yaml（即读取config.yaml配置文件数据）。

为简化Web Server的运行配置，ghttp默认配置目录为当前执行文件目录，并将配置路径下的config.yaml配置文件作为默认全局配置文件，并可在运行时通过SetPath修改配置目录。

>[danger] # 使用示例

我们来一个看示例，演示如何读取全局配置的信息，这是一个默认的全局配置文件，包含了模板引擎的目录配置以及MySQL数据库集群(两台master)的配置。

https://gitee.com/johng/gf/blob/master/geg/frame/config.yaml

```yaml
# 模板引擎目录
viewpath: /home/www/templates/
# MySQL数据库配置
database:
    default:
        - host:     127.0.0.1
          port:     3306
          user:     root
          pass:     123456
          name:     test
          type:     mysql
          role:     master
          charset:  utf-8
          priority: 1
        - host:     127.0.0.1
          port:     3306
          user:     root
          pass:     123456
          name:     test
          type:     mysql
          role:     master
          charset:  utf-8
          priority: 1
```

我们来读取第一个数据库配置的host信息，并输出到浏览器上：

https://gitee.com/johng/gf/blob/master/geg/frame/mvc/controller/demo/config.go

```go
package demo

import (
    "gitee.com/johng/gf/g/net/ghttp"
    "gitee.com/johng/gf/g/frame/gins"
)

func init() {
    ghttp.GetServer().BindHandler("/config", func (r *ghttp.Request) {
        r.Response.WriteString(gins.Config().GetString("database.default.0.host"))
    })
}
```
以上示例为读取数据库的第一个配置的host信息。

运行main.go，访问：http://127.0.0.1:8199/config ，可以看到页面输出：
	
	127.0.0.1

可以看到，gf框架的配置管理可以通过英文“.”号进行层级访问（数组默认从0开始），pattern参数“database.default.0.host”表示读取database配置项中default数据库集群中的第0项数据库服务器的host数据。

>[danger] # 修改配置目录

配置管理器作为gf框架的核心组件，**可以通过修改环境变量或者命令行参数自定义配置文件的目录路径，环境变量和参数名称都为cfgpath**。

例如，我们的执行程序文件为main，那么可以通过以下方式修改配置管理器的配置文件目录(Linux下)：

1. 通过命令行参数
    ```shell
    ./main --cfgpath=/opt/config/
    ```
1. 通过环境变量
    ```shell
    cfgpath=/opt/config/; ./main
    ```


